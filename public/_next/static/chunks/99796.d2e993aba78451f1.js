"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99796],{99796:function(e,t,i){i.d(t,{EmbeddedWalletSdk:function(){return O}});var a=i(88615),r=i(69338);let s=e=>`thirdwebEwsWalletUserId-${e}`,n=e=>`walletToken-${e}`,o=(e,t)=>`a-${e}-${t}`,l=new Map;class c{constructor({clientId:e}){Object.defineProperty(this,"isSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isSupported="undefined"!=typeof window&&!!window.localStorage,this.clientId=e}async getItem(e){return this.isSupported?window.localStorage.getItem(e):l.get(e)??null}async setItem(e,t){if(this.isSupported)return window.localStorage.setItem(e,t);l.set(e,t)}async removeItem(e){let t=await this.getItem(e);return!!this.isSupported&&!!t&&(window.localStorage.removeItem(e),!0)}async saveAuthCookie(e){await this.setItem(n(this.clientId),e)}async getAuthCookie(){return this.getItem(n(this.clientId))}async removeAuthCookie(){return this.removeItem(n(this.clientId))}async saveDeviceShare(e,t){await this.saveWalletUserId(t),await this.setItem(o(this.clientId,t),e)}async getDeviceShare(){let e=await this.getWalletUserId();return e?this.getItem(o(this.clientId,e)):null}async removeDeviceShare(){let e=await this.getWalletUserId();return!!e&&this.removeItem(o(this.clientId,e))}async getWalletUserId(){return this.getItem(s(this.clientId))}async saveWalletUserId(e){await this.setItem(s(this.clientId),e)}async removeWalletUserId(){return this.removeItem(s(this.clientId))}}function d(e){return new Promise(t=>{setTimeout(t,1e3*e)})}let u={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},h=new Map;class g{constructor({link:e,baseUrl:t,iframeId:i,container:a=document.body,onIframeInitialize:r}){Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.iframeBaseUrl=t;let s=document.getElementById(i),n=new URL(e);if(!s||s.src!==n.href){if(!s){s=document.createElement("iframe");let e={...u};Object.assign(s.style,e),s.setAttribute("id",i),s.setAttribute("fetchpriority","high"),a.appendChild(s)}s.src=n.href;let e=t=>{if("ewsIframeLoaded"===t.data.eventType){if(window.removeEventListener("message",e),!s){console.warn("thirdweb Iframe not found");return}this.onIframeLoadHandler(s,r)()}};window.addEventListener("message",e)}this.iframe=s}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{let i=new Promise(async(i,a)=>{let r=new MessageChannel;r.port1.onmessage=s=>{let{data:n}=s;return(r.port1.close(),n.success)?(h.set(e.src,!0),t&&t(),i(!0)):a(Error(n.error))},e?.contentWindow?.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[r.port2])});await i}}async call({procedureName:e,params:t,showIframe:i=!1}){for(;!h.get(this.iframe.src);)await d(this.POLLING_INTERVAL_SECONDS);return i&&(this.iframe.style.display="block",await d(.005)),new Promise((a,r)=>{let s=new MessageChannel;s.port1.onmessage=async e=>{let{data:t}=e;s.port1.close(),i&&(await d(.1),this.iframe.style.display="none"),t.success?a(t.data):r(Error(t.error))},this.iframe.contentWindow?.postMessage({eventType:e,data:t},this.iframeBaseUrl,[s.port2])})}destroy(){h.delete(this.iframe.src)}}class w extends g{constructor({clientId:e,baseUrl:t}){super({iframeId:p,link:function({clientId:e,baseUrl:t,path:i,queryParams:a}){let r=new URL(`${i}`,t);if(a)for(let e of Object.keys(a))r.searchParams.set(e,a[e]?.toString()||"");return r.searchParams.set("clientId",e),r}({clientId:e,path:"/sdk/2022-08-12/embedded-wallet",baseUrl:t}).href,baseUrl:t,container:document.body}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.clientId=e}async onIframeLoadedInitVariables(){let e=new c({clientId:this.clientId});return{authCookie:await e.getAuthCookie(),deviceShareStored:await e.getDeviceShare(),walletUserId:await e.getWalletUserId(),clientId:this.clientId}}}let p="thirdweb-embedded-wallet-iframe";var m=i(57817);class b{constructor({baseUrl:e,querier:t,preLogin:i,postLogin:a,client:r}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=e,this.LoginQuerier=t,this.preLogin=i,this.postLogin=a,this.client=r}async sendEmailLoginOtp({email:e}){return await this.preLogin(),await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:e}})}}class I extends b{constructor(){super(...arguments),Object.defineProperty(this,"closeWindow",{enumerable:!0,configurable:!0,writable:!0,value:({isWindowOpenedByFn:e,win:t,closeOpenedWindow:i})=>{e?t?.close():t&&i?i(t):t&&t.close()}})}async getOauthLoginUrl(e){return await this.LoginQuerier.call({procedureName:"getHeadlessOauthLoginLink",params:{authProvider:e}})}async loginWithModal(){await this.preLogin();let e=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0});return this.postLogin(e)}async loginWithEmailOtp({email:e}){await this.preLogin();let t=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:e},showIframe:!0});return this.postLogin(t)}getOauthPopUpSizing(e){return e===m.H.FACEBOOK?"width=715, height=555":"width=350, height=500"}async loginWithOauth(e){let t=e?.openedWindow,i=!1;if(t||(t=window.open("","Login",this.getOauthPopUpSizing(e.oauthProvider)),i=!0),!t)throw Error("Something went wrong opening pop-up");let[{loginLink:a}]=await Promise.all([this.getOauthLoginUrl(e.oauthProvider),this.preLogin()]);t.location.href=a;let r=await new Promise((a,r)=>{let s=window.setInterval(async()=>{t&&t.closed&&(clearInterval(s),window.removeEventListener("message",n),r(Error("User closed login window")))},1e3),n=async o=>{if(o.origin===this.baseUrl){if("object"!=typeof o.data){r(Error("Invalid event data"));return}switch(o.data.eventType){case"userLoginSuccess":window.removeEventListener("message",n),clearInterval(s),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:e?.closeOpenedWindow}),o.data.authResult&&a(o.data.authResult);break;case"userLoginFailed":window.removeEventListener("message",n),clearInterval(s),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:e?.closeOpenedWindow}),r(Error(o.data.error));break;case"injectDeveloperClientId":t?.postMessage({eventType:"injectDeveloperClientIdResult",developerClientId:this.client.clientId,authOption:e.oauthProvider},this.baseUrl)}}};window.addEventListener("message",n)});return this.postLogin({storedToken:{...r.storedToken,shouldStoreCookieString:!0},walletDetails:{...r.walletDetails,isIframeStorageEnabled:!1}})}async loginWithCustomJwt({encryptionKey:e,jwt:t}){await this.preLogin();let i=await this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:e,jwt:t}});return this.postLogin(i)}async loginWithCustomAuthEndpoint({encryptionKey:e,payload:t}){await this.preLogin();let i=await this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:e,payload:t}});return this.postLogin(i)}async verifyEmailLoginOtp({email:e,otp:t,recoveryCode:i}){let a=await this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:e,otp:t,recoveryCode:i}});return this.postLogin(a)}}class f{constructor({client:e,querier:t,onAuthSuccess:i,baseUrl:a}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.AuthQuerier=t,this.localStorage=new c({clientId:e.clientId}),this.onAuthSuccess=i,this.BaseLogin=new I({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},querier:t,client:e,baseUrl:a})}async preLogin(){await this.logout()}async postLogin({storedToken:e,walletDetails:t}){return e.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(e.cookieString),await this.onAuthSuccess({storedToken:e,walletDetails:t})}async loginWithModal(){return this.BaseLogin.loginWithModal()}async loginWithEmailOtp(e){return this.BaseLogin.loginWithEmailOtp(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async loginWithOauth(e){return this.BaseLogin.loginWithOauth(e)}async sendEmailLoginOtp({email:e}){return this.BaseLogin.sendEmailLoginOtp({email:e})}async verifyEmailLoginOtp(e){return this.BaseLogin.verifyEmailLoginOtp(e)}async logout(){let{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),i=await this.localStorage.removeWalletUserId();return{success:e||t||i}}}var v=i(5940),y=i(95810);async function L(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}class E{constructor({client:e,querier:t}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.walletManagerQuerier=t,this.localStorage=new c({clientId:e.clientId})}async postWalletSetUp({deviceShareStored:e,walletAddress:t,isIframeStorageEnabled:i,walletUserId:a}){return i||await this.localStorage.saveDeviceShare(e,a),{walletAddress:t}}async getUserWalletStatus(){let e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===r.N.LOGGED_IN_WALLET_INITIALIZED?{status:r.N.LOGGED_IN_WALLET_INITIALIZED,...e.user,wallet:this}:e.status===r.N.LOGGED_IN_NEW_DEVICE?{status:r.N.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:e.status===r.N.LOGGED_IN_WALLET_UNINITIALIZED?{status:r.N.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async getAccount(){let e=this.walletManagerQuerier,{address:t}=await e.call({procedureName:"getAddress",params:void 0}),i=async t=>{let{signedTransaction:i}=await e.call({procedureName:"signTransaction",params:{transaction:{to:t.to??void 0,data:t.data,value:t.value,gasLimit:t.gas,gasPrice:t.gasPrice,nonce:t.nonce,chainId:t.chainId,accessList:t.accessList,maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas,type:t.maxFeePerGas?2:0},chainId:t.chainId,rpcEndpoint:`https://${t.chainId}.rpc.thirdweb.com`}});return i},a=this.client;return{address:t,async sendTransaction(e){let t=(0,v.getRpcClient)({client:a,chain:(0,y.ax)(e.chainId)}),r=await i(e);return{transactionHash:await L(t,r)}},async signMessage({message:t}){let i="string"==typeof t?t:t.raw,{signedMessage:a}=await e.call({procedureName:"signMessage",params:{message:i,chainId:1}});return a},async signTypedData(t){t.types&&t.types.EIP712Domain&&delete t.types.EIP712Domain;let i=Number(t.domain?.chainId||1),{signedTypedData:a}=await e.call({procedureName:"signTypedDataV4",params:{domain:t.domain,types:t.types,message:t.message,chainId:i,rpcEndpoint:`https://${i}.rpc.thirdweb.com`}});return a}}}}class O{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}constructor({client:e,onAuthSuccess:t}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(e.clientId))throw Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");let i=`https://${(0,a.gc)().embeddedWallet}`;this.client=e,this.querier=new w({clientId:e.clientId,baseUrl:i}),this.wallet=new E({client:e,querier:this.querier}),this.auth=new f({client:e,querier:this.querier,baseUrl:i,onAuthSuccess:async e=>(t?.(e),await this.wallet.postWalletSetUp({...e.walletDetails,walletUserId:e.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{deviceShareStored:e.walletDetails.deviceShareStored,clientId:this.client.clientId,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:r.N.LOGGED_IN_WALLET_INITIALIZED,authDetails:e.storedToken.authDetails,wallet:this.wallet,walletAddress:e.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}}}}]);